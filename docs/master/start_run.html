<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Thrill: Running Thrill programs on a cluster</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Thrill
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('start_run.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Running Thrill programs on a cluster </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h3>Execution Model</h3>
<p>Thrill programs are binary executables which run simultaneously on <em>h</em> hosts in a cluster with equal hardware configuration. Generally, they use all cores and RAM available on the host and communicate via a network protocol. If external disk memory is used, this should be on local disks.</p>
<div class="image">
<object type="image/svg+xml" data="cluster-execution.svg">cluster-execution.svg</object>
</div>
<p>The input and output is usually stored on a fault tolerance distributed file system like Ceph, Lustre, NFS, or HDFS. Currently Thrill only supports the standard (POSIX) file system (HDFS's proprietary interface may be added some day).</p>
<p>In general, the startup procedure has the goal to launch the <em>same binary</em> on all hosts. On startup, the Thrill binary will then connect to the other running instances via the network. Hence, the host, port and other connection parameters of the other instances must be passed.</p>
<p>We provide a set of <code>run</code> scripts in the source package, which automatically launch Thrill programs via SSH, on a set of AWS EC2 instances, and on clusters scheduled by slurm. MPI is also supported natively.</p>
<p>When started with no parameters, Thrill programs run locally and simulate a two host network with all cores available on the machine divided into the two virtual hosts. Communication is performed via local kernel sockets on Linux.</p>
<p>Thrill's configuration is passed via the standard Unix environment variables. This makes it easy to traverse hosts in a cluster. See <a class="el" href="start_environment.html">Environment Configuration Variables</a> for more configuration options.</p>
<h3>Running via SSH</h3>
<p>The bash script <code>run/ssh/invoke.sh</code> launches the same binary on a set of hosts via ssh. These should be setup with ssh keys for authentication.</p>
<p>For example, the following will launch the WordCount example on two hosts called <code>jupiter</code> and <code>saturn</code>. We assume Thrill is in directory <code>~/thrill</code>.</p>
<div class="fragment"><div class="line">$ cd ~/<a class="code" href="namespacethrill.html">thrill</a>/build/<a class="code" href="namespaceexamples.html">examples</a>/word_count/</div><div class="line">$ ~/<a class="code" href="namespacethrill.html">thrill</a>/run/ssh/invoke.sh -h <span class="stringliteral">&quot;jupiter saturn&quot;</span> word_count_run --generate 1000 --output result-</div></div><!-- fragment --><p>This ssh invocation assumes a <b>common distributed file system</b> on all hosts including the launcher. This is a common setup in Linux clusters with an NFS server. In principle, the script access each machine via ssh and launches the <code>word_count_run</code> executable with the additional connection parameters. All arguments after word_count_run are passed on.</p>
<p>One can also launch Thrill programs on a "remote" cluster which does not contain the executable. This is done by simply adding the <code>-c</code> option. The script then <b>copies the executable</b> via ssh to the remote hosts and runs it from <code>/tmp</code>.</p>
<h3>Running via MPI</h3>
<p>The simplest method to run Thrill programs in a cluster is using MPI. If compiled with an MPI library like OpenMPI, the Thrill program will detect that it is running under MPI and use MPI calls to communicate. No configuration is needed.</p>
<p>However, we have had many problems with multi-threading and MPI libraries.</p>
<h3>Running on AWS EC2</h3>
<p>We often run Thrill programs on a set of bare-bone EC2 instances running on AWS. In principle these are accessed via SSH and the Thrill program is uploaded from the development machine.</p>
<p>The process of looking up the currently running EC2 instances, reading the public and private IPs, etc, is automated by the scripts in <code>run/ec2/</code>. The python scripts require the boto3 library, which is available via pip.</p>
<p>First run <code>~/thrill/run/ec2/make_env.py</code> and check the output for running EC2 instances.</p>
<p>Then run <code>~/thrill/run/ec2/invoke.sh</code> which runs ssh's invoke with all EC2 instances. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Thrill Documentation Overview</a></li><li class="navelem"><a class="el" href="start.html">Getting Started</a></li>
    <li class="footer">Generated on Sat Apr 4 2020 07:53:56 for Thrill by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
