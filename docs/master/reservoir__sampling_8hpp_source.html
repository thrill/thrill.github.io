<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Thrill: thrill/common/reservoir_sampling.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Thrill
   &#160;<span id="projectnumber">0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('reservoir__sampling_8hpp_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">reservoir_sampling.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="reservoir__sampling_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*******************************************************************************</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * thrill/common/reservoir_sampling.hpp</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Part of Project Thrill - http://project-thrill.org</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Copyright (C) 2017 Timo Bingmann &lt;tb@panthema.net&gt;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * All rights reserved. Published under the BSD-2 license in the LICENSE file.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> ******************************************************************************/</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#pragma once</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#ifndef THRILL_COMMON_RESERVOIR_SAMPLING_HEADER</span></div>
<div class="line"><a name="l00013"></a><span class="lineno"><a class="line" href="reservoir__sampling_8hpp.html#a266269fd533dc4e5a4fd6f02693f7e12">   13</a></span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define THRILL_COMMON_RESERVOIR_SAMPLING_HEADER</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="thrill_2common_2logger_8hpp.html">thrill/common/logger.hpp</a>&gt;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &lt;cassert&gt;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &lt;cmath&gt;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">namespace </span>thrill {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">namespace </span>common {</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">/*!</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> * Implementation of reservoir sampling using Vitter&#39;s Algorithm R. The</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment"> * reservoir size is fixed, new items replace old ones such that all items in</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"> * the stream are sampled with the same uniform probability.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</div>
<div class="line"><a name="l00030"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html">   30</a></span>&#160;<span class="keyword">class </span><a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html">ReservoirSampling</a></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;{</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">    //! initialize reservoir sampler</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#ac6ae522d34e665be4a8489a16ad76f63">   34</a></span>&#160;<span class="comment"></span>    <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ac6ae522d34e665be4a8489a16ad76f63">ReservoirSampling</a>(<span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#aac782da1f912bceb5d8ad00c8dc892ac">size</a>, std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a35e83b77174bc9895cbc88cab7a7f706">samples</a>,</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                      std::default_random_engine&amp; rng)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        : <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>(size), <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">samples_</a>(samples), <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>(rng) {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">samples_</a>.reserve(<a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    }</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">    //! visit item, maybe add it to the sample.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#ad5f1310100120dfab09b7ff82c3460f8">   41</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ad5f1310100120dfab09b7ff82c3460f8">add</a>(<span class="keyword">const</span> <a class="code" href="namespacethrill_1_1vfs.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a>&amp; item) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        ++<a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a6b06728795e8f208c0755874665b3a51">count_</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a6b06728795e8f208c0755874665b3a51">count_</a> &lt;= <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="comment">// if reservoir is too small then store item</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">samples_</a>.emplace_back(item);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;            <span class="comment">// maybe replace an item</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            <span class="keywordtype">size_t</span> <a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>() % <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a6b06728795e8f208c0755874665b3a51">count_</a>;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordflow">if</span> (x &lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>)</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">samples_</a>[<a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a>] = item;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">    //! size of reservoir</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#aac782da1f912bceb5d8ad00c8dc892ac">   56</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#aac782da1f912bceb5d8ad00c8dc892ac">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>; }</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">    //! number of items seen</span></div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#a22a9772c09848d90444dda7fefa4d9ce">   59</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a22a9772c09848d90444dda7fefa4d9ce">count</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a6b06728795e8f208c0755874665b3a51">count_</a>; }</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">    //! access to samples</span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#a35e83b77174bc9895cbc88cab7a7f706">   62</a></span>&#160;<span class="comment"></span>    <span class="keyword">const</span> std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a35e83b77174bc9895cbc88cab7a7f706">samples</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">samples_</a>; }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">    //! size of reservoir</span></div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">   66</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>;<span class="comment"></span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">    //! number of items seen</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#a6b06728795e8f208c0755874665b3a51">   68</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#a6b06728795e8f208c0755874665b3a51">count_</a> = 0;<span class="comment"></span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">    //! reservoir</span></div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">   70</a></span>&#160;<span class="comment"></span>    std::vector&lt;Type&gt; <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">samples_</a>;<span class="comment"></span></div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">    //! source of randomness</span></div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSampling.html#afa3210bc46cfad23b98aa3743b80024b">   72</a></span>&#160;<span class="comment"></span>    std::default_random_engine&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSampling.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;};</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/*!</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment"> * Implementation of a fast approximation of reservoir sampling using</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment"> * http://erikerlandson.github.io/blog/2015/11/20/very-fast-reservoir-sampling/</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment"> * The reservoir size is fixed, new items replace old ones such that all items</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment"> * in the stream are sampled with the same uniform probability.</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html">   82</a></span>&#160;<span class="keyword">class </span><a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html">ReservoirSamplingFast</a></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;{</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">    //! initialize reservoir sampler</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ad7747686eefe4c9938cab0ada1a84329">   86</a></span>&#160;<span class="comment"></span>    <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ad7747686eefe4c9938cab0ada1a84329">ReservoirSamplingFast</a>(<span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aac782da1f912bceb5d8ad00c8dc892ac">size</a>, std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a35e83b77174bc9895cbc88cab7a7f706">samples</a>,</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                          std::default_random_engine&amp; rng)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        : <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>(size), <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>(samples), <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>(rng) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>.reserve(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>);</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;<span class="comment">    //! visit item, maybe add it to the sample.</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ad5f1310100120dfab09b7ff82c3460f8">   93</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ad5f1310100120dfab09b7ff82c3460f8">add</a>(<span class="keyword">const</span> <a class="code" href="namespacethrill_1_1vfs.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a>&amp; item) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        ++<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a> &lt;= 4 * <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) {</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a> &lt;= <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="comment">// if reservoir is too small then store item</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>.emplace_back(item);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;            }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                <span class="comment">// use Vitter&#39;s algorithm for small count_</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="keywordtype">size_t</span> <a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>() % <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a>;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                <span class="keywordflow">if</span> (x &lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>)</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>[<a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a>] = item;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                <span class="comment">// when count_ reaches 4 * size_ switch to gap algorithm</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a> == 4 * <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>)</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a36e9b114cd99244356721de926795597">calc_next_gap</a>();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;            }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a> == 0) {</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="comment">// gap elapsed, this item is a sample</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="keywordtype">size_t</span> <a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>() % <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>[<a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a>] = item;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <span class="comment">// pick gap size: the next gap_ items are not samples</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;            <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a36e9b114cd99244356721de926795597">calc_next_gap</a>();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            --<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a>;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;        }</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">    //! size of reservoir</span></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aac782da1f912bceb5d8ad00c8dc892ac">  125</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aac782da1f912bceb5d8ad00c8dc892ac">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>; }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">    //! number of items seen</span></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a22a9772c09848d90444dda7fefa4d9ce">  128</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a22a9772c09848d90444dda7fefa4d9ce">count</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a>; }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">    //! access to samples</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a35e83b77174bc9895cbc88cab7a7f706">  131</a></span>&#160;<span class="comment"></span>    <span class="keyword">const</span> std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a35e83b77174bc9895cbc88cab7a7f706">samples</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>; }</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">    //! size of reservoir</span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">  135</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>;<span class="comment"></span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">    //! number of items seen</span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">  137</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a> = 0;<span class="comment"></span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">    //! source of randomness</span></div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ab8ca9afa9d9a2d502b0b8a0da644872e">  139</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a>;<span class="comment"></span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment">    //! reservoir</span></div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">  141</a></span>&#160;<span class="comment"></span>    std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>;<span class="comment"></span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">    //! source of randomness</span></div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">  143</a></span>&#160;<span class="comment"></span>    std::default_random_engine&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">    //! draw gap size from geometric distribution with p = size_ / count_</span></div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a36e9b114cd99244356721de926795597">  146</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a36e9b114cd99244356721de926795597">calc_next_gap</a>() {</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="keywordflow">if</span> (0) {</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="comment">// this is slower than the simpler approximation below</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            <span class="keywordflow">return</span> std::geometric_distribution&lt;size_t&gt;(</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) / static_cast&lt;double&gt;(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a>))(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="comment">// generate a geometric distributed variant with p = size_ / count_</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="keywordtype">double</span> p = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) / static_cast&lt;double&gt;(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">count_</a>);</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordtype">double</span> u = std::uniform_real_distribution&lt;double&gt;()(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">return</span> std::floor(std::log(u) / std::log(1 - p));</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;        }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;};</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment">/*!</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment"> * Implementation of a fast approximation of adaptive reservoir sampling using</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment"> * http://erikerlandson.github.io/blog/2015/11/20/very-fast-reservoir-sampling/</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment"> * The reservoir size grows logarithmically with the number given to the</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment"> * sampler, new items replace old ones such that all items in the stream are</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment"> * sampled with the same approximately uniform probability.</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment"> * Growing of the reservoir is implemented trivially by selecting any current</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment"> * item to expand the array. This works well enough if growing steps become</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment"> * rarer for larger streams.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;<span class="keyword">template</span> &lt;<span class="keyword">typename</span> Type&gt;</div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html">  173</a></span>&#160;<span class="keyword">class </span><a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html">ReservoirSamplingGrow</a></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;{</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b72e54baf646b08b4b87f987f583dcb">  175</a></span>&#160;    <span class="keyword">static</span> constexpr <span class="keywordtype">bool</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b72e54baf646b08b4b87f987f583dcb">debug</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;<span class="keyword">public</span>:<span class="comment"></span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;<span class="comment">    //! initialize reservoir sampler</span></div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a2a9274608e3f1878af01d3d1b68d1a86">  179</a></span>&#160;<span class="comment"></span>    <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a2a9274608e3f1878af01d3d1b68d1a86">ReservoirSamplingGrow</a>(std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a35e83b77174bc9895cbc88cab7a7f706">samples</a>,</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                          std::default_random_engine&amp; rng,</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                          <span class="keywordtype">double</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ae53184f3ec7d3522a3f36f681bc5e26c">desired_imbalance</a> = 0.05)</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        : <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>(samples), <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>(rng), <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">desired_imbalance_</a>(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ae53184f3ec7d3522a3f36f681bc5e26c">desired_imbalance</a>)</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    { }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;<span class="comment">    //! visit item, maybe add it to the sample.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ad5f1310100120dfab09b7ff82c3460f8">  186</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">void</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ad5f1310100120dfab09b7ff82c3460f8">add</a>(<span class="keyword">const</span> <a class="code" href="namespacethrill_1_1vfs.html#a1d1cfd8ffb84e947f82999c682b666a7">Type</a>&amp; item) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <a class="code" href="thrill_2common_2logger_8hpp.html#af14c6f708bfe284dacf04d7866461a32">sLOG0</a> &lt;&lt; <span class="stringliteral">&quot;ReservoirSamplingGrow::add&quot;</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;count_&quot;</span> &lt;&lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;size_&quot;</span> &lt;&lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;              &lt;&lt; <span class="stringliteral">&quot;gap_&quot;</span> &lt;&lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a>;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        ++<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        <span class="comment">// check if reservoir should be resize, this is equivalent to the check</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        <span class="comment">// if (size_ != calc_sample_size())</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8acc71da85d7ab98b1507ba75526383f">steps_to_resize</a> == 0)</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        {</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="comment">// calculate new reservoir size</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordtype">size_t</span> target_size = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8f041af932c573b31b28ab022a5c410a">calc_sample_size</a>();</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8acc71da85d7ab98b1507ba75526383f">steps_to_resize</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a44d02ef658f5ec305b4e5c3994d28c63">calc_steps_to_next_resize</a>();</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <a class="code" href="thrill_2common_2logger_8hpp.html#a7d888e928a1068cc90c57560ad5d669a">sLOG</a> &lt;&lt; <span class="stringliteral">&quot;steps_to_resize&quot;</span> &lt;&lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8acc71da85d7ab98b1507ba75526383f">steps_to_resize</a></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;target_size&quot;</span> &lt;&lt; target_size</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;size_&quot;</span> &lt;&lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a> &lt;&lt; <span class="stringliteral">&quot;count_&quot;</span> &lt;&lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot;expanded_by&quot;</span> &lt;&lt; target_size - <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            assert(target_size &gt;= size_);</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="comment">// expand reservoir, sample new items from existing and new one</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            <span class="keywordflow">while</span> (size_ &lt; target_size) {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <span class="keywordtype">size_t</span> <a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>() % (size_ + 1);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">if</span> (x != size_)</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>.emplace_back(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>[x]);</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                    <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>.emplace_back(item);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                ++<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            --<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8acc71da85d7ab98b1507ba75526383f">steps_to_resize</a>;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        assert(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>.size() == <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b72e54baf646b08b4b87f987f583dcb">debug</a> &amp;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a> != <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8f041af932c573b31b28ab022a5c410a">calc_sample_size</a>())</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <a class="code" href="thrill_2common_2logger_8hpp.html#aa92cc370e6906ac3887db96a0a628ce8">LOG0</a> &lt;&lt; <span class="stringliteral">&quot;delta: &quot;</span> &lt;&lt; (<span class="keywordtype">int</span>)<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a> - (int)<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8f041af932c573b31b28ab022a5c410a">calc_sample_size</a>()</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; count_ &quot;</span> &lt;&lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a> &lt;= 4 * <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) {</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a> &lt;= <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="comment">// fill slots initially in order</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>[<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a> - 1] = item;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="comment">// replace items using Vitter&#39;s Algorithm R</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="keywordtype">size_t</span> <a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>() % <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a>;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="keywordflow">if</span> (x &lt; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>[<a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a>] = item;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="comment">// when count_ reaches 4 * size_ switch to gap algorithm</span></div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a> == 4 * <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    gap_ = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a36e9b114cd99244356721de926795597">calc_next_gap</a>();</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gap_ == 0) {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="comment">// gap elapsed, this item is a sample</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            <span class="keywordtype">size_t</span> <a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a> = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>() % <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;            <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>[<a class="code" href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">x</a>] = item;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="comment">// pick gap size: the next gap_ items are not samples</span></div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;            gap_ = <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a36e9b114cd99244356721de926795597">calc_next_gap</a>();</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        }</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            --<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        }</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="comment">    //! size of reservoir</span></div>
<div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aac782da1f912bceb5d8ad00c8dc892ac">  257</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aac782da1f912bceb5d8ad00c8dc892ac">size</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>; }</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="comment">    //! number of items seen</span></div>
<div class="line"><a name="l00260"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a22a9772c09848d90444dda7fefa4d9ce">  260</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a22a9772c09848d90444dda7fefa4d9ce">count</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a>; }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="comment">    //! access to samples</span></div>
<div class="line"><a name="l00263"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a35e83b77174bc9895cbc88cab7a7f706">  263</a></span>&#160;<span class="comment"></span>    <span class="keyword">const</span> std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a35e83b77174bc9895cbc88cab7a7f706">samples</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>; }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">    //! desired imbalance</span></div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ae53184f3ec7d3522a3f36f681bc5e26c">  266</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">double</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ae53184f3ec7d3522a3f36f681bc5e26c">desired_imbalance</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">desired_imbalance_</a>; }</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="comment">    //! calculate desired sample size</span></div>
<div class="line"><a name="l00269"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a2000032e027274fe1658be49ec98fc51">  269</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a2000032e027274fe1658be49ec98fc51">calc_sample_size</a>(<span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a22a9772c09848d90444dda7fefa4d9ce">count</a>)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="keywordtype">size_t</span> s = <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            std::log2(count)</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            * (1.0 / (<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">desired_imbalance_</a> * <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">desired_imbalance_</a>)));</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="namespacethrill_1_1common.html#ac55d70406741c4f4be46fbb8f4dfd832">std::max</a>(s, <span class="keywordtype">size_t</span>(1));</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="comment">    //! calculate desired sample size</span></div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8f041af932c573b31b28ab022a5c410a">  277</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8f041af932c573b31b28ab022a5c410a">calc_sample_size</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8f041af932c573b31b28ab022a5c410a">calc_sample_size</a>(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;<span class="keyword">private</span>:<span class="comment"></span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;<span class="comment">    //! size of reservoir</span></div>
<div class="line"><a name="l00283"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">  283</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a> = 0;<span class="comment"></span></div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;<span class="comment">    //! number of items seen</span></div>
<div class="line"><a name="l00285"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">  285</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a> = 0;<span class="comment"></span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;<span class="comment">    //! items to skip until next sample (used in gap algorithm)</span></div>
<div class="line"><a name="l00287"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ab8ca9afa9d9a2d502b0b8a0da644872e">  287</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ab8ca9afa9d9a2d502b0b8a0da644872e">gap_</a> = 0;<span class="comment"></span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;<span class="comment">    //! items to process prior to checking for reservoir resize</span></div>
<div class="line"><a name="l00289"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8acc71da85d7ab98b1507ba75526383f">  289</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8acc71da85d7ab98b1507ba75526383f">steps_to_resize</a> = 0;<span class="comment"></span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;<span class="comment">    //! reservoir</span></div>
<div class="line"><a name="l00291"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">  291</a></span>&#160;<span class="comment"></span>    std::vector&lt;Type&gt;&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">samples_</a>;<span class="comment"></span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;<span class="comment">    //! source of randomness</span></div>
<div class="line"><a name="l00293"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">  293</a></span>&#160;<span class="comment"></span>    std::default_random_engine&amp; <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;<span class="comment">    //! epsilon imbalance: this reservoir sampling works well for the range 0.5</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;<span class="comment">    //! to 0.01. Imbalance 0.5 results in 79 samples for 1 million items, 0.1 in</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;<span class="comment">    //! 1992, 0.05 in 6643, 0.02 in 49828, and 0.01 in 199315.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">  298</a></span>&#160;<span class="comment"></span>    <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">desired_imbalance_</a>;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;<span class="comment">    //! draw gap size from geometric distribution with p = size_ / count_</span></div>
<div class="line"><a name="l00301"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a36e9b114cd99244356721de926795597">  301</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a36e9b114cd99244356721de926795597">calc_next_gap</a>() {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        <span class="keywordflow">if</span> (0) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="comment">// this is slower than the simpler approximation below</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keywordflow">return</span> std::geometric_distribution&lt;size_t&gt;(</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) / static_cast&lt;double&gt;(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a>))(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>);</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="comment">// generate a geometric distributed variant with p = size_ / count_</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordtype">double</span> p = <span class="keyword">static_cast&lt;</span><span class="keywordtype">double</span><span class="keyword">&gt;</span>(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">size_</a>) / static_cast&lt;double&gt;(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a>);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;            <span class="keywordtype">double</span> u = std::uniform_real_distribution&lt;double&gt;()(<a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">rng_</a>);</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">return</span> std::floor(std::log(u) / std::log(1 - p));</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        }</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment">    //! calculate number of items/steps to process without checking for sample</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment">    //! resize</span></div>
<div class="line"><a name="l00317"></a><span class="lineno"><a class="line" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a44d02ef658f5ec305b4e5c3994d28c63">  317</a></span>&#160;<span class="comment"></span>    <span class="keywordtype">size_t</span> <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a44d02ef658f5ec305b4e5c3994d28c63">calc_steps_to_next_resize</a>()<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">return</span> std::floor(</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">count_</a> * (</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                std::pow(2.0, <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">desired_imbalance_</a> * <a class="code" href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">desired_imbalance_</a>) - 1.0));</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    }</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;};</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;} <span class="comment">// namespace common</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;} <span class="comment">// namespace thrill</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="preprocessor">#endif // !THRILL_COMMON_RESERVOIR_SAMPLING_HEADER</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">/******************************************************************************/</span></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_afa3210bc46cfad23b98aa3743b80024b"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#afa3210bc46cfad23b98aa3743b80024b">thrill::common::ReservoirSampling::rng_</a></div><div class="ttdeci">std::default_random_engine &amp; rng_</div><div class="ttdoc">source of randomness </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00072">reservoir_sampling.hpp:72</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a2a9274608e3f1878af01d3d1b68d1a86"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a2a9274608e3f1878af01d3d1b68d1a86">thrill::common::ReservoirSamplingGrow::ReservoirSamplingGrow</a></div><div class="ttdeci">ReservoirSamplingGrow(std::vector&lt; Type &gt; &amp;samples, std::default_random_engine &amp;rng, double desired_imbalance=0.05)</div><div class="ttdoc">initialize reservoir sampler </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00179">reservoir_sampling.hpp:179</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_a5f31775800bbb46b35b5791def1f3acc"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#a5f31775800bbb46b35b5791def1f3acc">thrill::common::ReservoirSampling::size_</a></div><div class="ttdeci">size_t size_</div><div class="ttdoc">size of reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00066">reservoir_sampling.hpp:66</a></div></div>
<div class="ttc" id="thrill_2common_2logger_8hpp_html_af14c6f708bfe284dacf04d7866461a32"><div class="ttname"><a href="thrill_2common_2logger_8hpp.html#af14c6f708bfe284dacf04d7866461a32">sLOG0</a></div><div class="ttdeci">#define sLOG0</div><div class="ttdoc">Override default output: never or always output log. </div><div class="ttdef"><b>Definition:</b> <a href="thrill_2common_2logger_8hpp_source.html#l00182">logger.hpp:182</a></div></div>
<div class="ttc" id="thrill_2common_2logger_8hpp_html_aa92cc370e6906ac3887db96a0a628ce8"><div class="ttname"><a href="thrill_2common_2logger_8hpp.html#aa92cc370e6906ac3887db96a0a628ce8">LOG0</a></div><div class="ttdeci">#define LOG0</div><div class="ttdoc">Override default output: never or always output log. </div><div class="ttdef"><b>Definition:</b> <a href="thrill_2common_2logger_8hpp_source.html#l00170">logger.hpp:170</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_ad5f1310100120dfab09b7ff82c3460f8"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ad5f1310100120dfab09b7ff82c3460f8">thrill::common::ReservoirSamplingFast::add</a></div><div class="ttdeci">void add(const Type &amp;item)</div><div class="ttdoc">visit item, maybe add it to the sample. </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00093">reservoir_sampling.hpp:93</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a8f041af932c573b31b28ab022a5c410a"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8f041af932c573b31b28ab022a5c410a">thrill::common::ReservoirSamplingGrow::calc_sample_size</a></div><div class="ttdeci">size_t calc_sample_size() const </div><div class="ttdoc">calculate desired sample size </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00277">reservoir_sampling.hpp:277</a></div></div>
<div class="ttc" id="namespacethrill_1_1vfs_html_a1d1cfd8ffb84e947f82999c682b666a7"><div class="ttname"><a href="namespacethrill_1_1vfs.html#a1d1cfd8ffb84e947f82999c682b666a7">thrill::vfs::Type</a></div><div class="ttdeci">Type</div><div class="ttdoc">VFS object type. </div><div class="ttdef"><b>Definition:</b> <a href="file__io_8hpp_source.html#l00052">file_io.hpp:52</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html">thrill::common::ReservoirSamplingGrow</a></div><div class="ttdoc">Implementation of a fast approximation of adaptive reservoir sampling using http://erikerlandson.github.io/blog/2015/11/20/very-fast-reservoir-sampling/ The reservoir size grows logarithmically with the number given to the sampler, new items replace old ones such that all items in the stream are sampled with the same approximately uniform probability. </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00173">reservoir_sampling.hpp:173</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_ae53184f3ec7d3522a3f36f681bc5e26c"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ae53184f3ec7d3522a3f36f681bc5e26c">thrill::common::ReservoirSamplingGrow::desired_imbalance</a></div><div class="ttdeci">double desired_imbalance() const </div><div class="ttdoc">desired imbalance </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00266">reservoir_sampling.hpp:266</a></div></div>
<div class="ttc" id="thrill_2common_2logger_8hpp_html"><div class="ttname"><a href="thrill_2common_2logger_8hpp.html">logger.hpp</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_ad7747686eefe4c9938cab0ada1a84329"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ad7747686eefe4c9938cab0ada1a84329">thrill::common::ReservoirSamplingFast::ReservoirSamplingFast</a></div><div class="ttdeci">ReservoirSamplingFast(size_t size, std::vector&lt; Type &gt; &amp;samples, std::default_random_engine &amp;rng)</div><div class="ttdoc">initialize reservoir sampler </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00086">reservoir_sampling.hpp:86</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_afa3210bc46cfad23b98aa3743b80024b"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#afa3210bc46cfad23b98aa3743b80024b">thrill::common::ReservoirSamplingFast::rng_</a></div><div class="ttdeci">std::default_random_engine &amp; rng_</div><div class="ttdoc">source of randomness </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00143">reservoir_sampling.hpp:143</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_acf8d35fee6167f79c7217f4e8297110f"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#acf8d35fee6167f79c7217f4e8297110f">thrill::common::ReservoirSamplingGrow::desired_imbalance_</a></div><div class="ttdeci">const double desired_imbalance_</div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00298">reservoir_sampling.hpp:298</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_ad5f1310100120dfab09b7ff82c3460f8"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ad5f1310100120dfab09b7ff82c3460f8">thrill::common::ReservoirSamplingGrow::add</a></div><div class="ttdeci">void add(const Type &amp;item)</div><div class="ttdoc">visit item, maybe add it to the sample. </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00186">reservoir_sampling.hpp:186</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_ad5f1310100120dfab09b7ff82c3460f8"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#ad5f1310100120dfab09b7ff82c3460f8">thrill::common::ReservoirSampling::add</a></div><div class="ttdeci">void add(const Type &amp;item)</div><div class="ttdoc">visit item, maybe add it to the sample. </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00041">reservoir_sampling.hpp:41</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_a35e83b77174bc9895cbc88cab7a7f706"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a35e83b77174bc9895cbc88cab7a7f706">thrill::common::ReservoirSamplingFast::samples</a></div><div class="ttdeci">const std::vector&lt; Type &gt; &amp; samples() const </div><div class="ttdoc">access to samples </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00131">reservoir_sampling.hpp:131</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html">thrill::common::ReservoirSampling</a></div><div class="ttdoc">Implementation of reservoir sampling using Vitter&#39;s Algorithm R. </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00030">reservoir_sampling.hpp:30</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_a5f31775800bbb46b35b5791def1f3acc"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a5f31775800bbb46b35b5791def1f3acc">thrill::common::ReservoirSamplingFast::size_</a></div><div class="ttdeci">size_t size_</div><div class="ttdoc">size of reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00135">reservoir_sampling.hpp:135</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html">thrill::common::ReservoirSamplingFast</a></div><div class="ttdoc">Implementation of a fast approximation of reservoir sampling using http://erikerlandson.github.io/blog/2015/11/20/very-fast-reservoir-sampling/ The reservoir size is fixed, new items replace old ones such that all items in the stream are sampled with the same uniform probability. </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00082">reservoir_sampling.hpp:82</a></div></div>
<div class="ttc" id="thrill_2common_2logger_8hpp_html_a7d888e928a1068cc90c57560ad5d669a"><div class="ttname"><a href="thrill_2common_2logger_8hpp.html#a7d888e928a1068cc90c57560ad5d669a">sLOG</a></div><div class="ttdeci">#define sLOG</div><div class="ttdoc">Default logging method: output if the local debug variable is true. </div><div class="ttdef"><b>Definition:</b> <a href="thrill_2common_2logger_8hpp_source.html#l00179">logger.hpp:179</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a2000032e027274fe1658be49ec98fc51"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a2000032e027274fe1658be49ec98fc51">thrill::common::ReservoirSamplingGrow::calc_sample_size</a></div><div class="ttdeci">size_t calc_sample_size(size_t count) const </div><div class="ttdoc">calculate desired sample size </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00269">reservoir_sampling.hpp:269</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a6b72e54baf646b08b4b87f987f583dcb"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b72e54baf646b08b4b87f987f583dcb">thrill::common::ReservoirSamplingGrow::debug</a></div><div class="ttdeci">static constexpr bool debug</div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00175">reservoir_sampling.hpp:175</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_a6b06728795e8f208c0755874665b3a51"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a6b06728795e8f208c0755874665b3a51">thrill::common::ReservoirSamplingFast::count_</a></div><div class="ttdeci">size_t count_</div><div class="ttdoc">number of items seen </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00137">reservoir_sampling.hpp:137</a></div></div>
<div class="ttc" id="namespacegen__data_html_a573e66358ede67c6f901dfaf4722f75a"><div class="ttname"><a href="namespacegen__data.html#a573e66358ede67c6f901dfaf4722f75a">gen_data.x</a></div><div class="ttdeci">list x</div><div class="ttdef"><b>Definition:</b> <a href="gen__data_8py_source.html#l00039">gen_data.py:39</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a5f31775800bbb46b35b5791def1f3acc"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a5f31775800bbb46b35b5791def1f3acc">thrill::common::ReservoirSamplingGrow::size_</a></div><div class="ttdeci">size_t size_</div><div class="ttdoc">size of reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00283">reservoir_sampling.hpp:283</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_aac782da1f912bceb5d8ad00c8dc892ac"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aac782da1f912bceb5d8ad00c8dc892ac">thrill::common::ReservoirSamplingGrow::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdoc">size of reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00257">reservoir_sampling.hpp:257</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_ac6ae522d34e665be4a8489a16ad76f63"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#ac6ae522d34e665be4a8489a16ad76f63">thrill::common::ReservoirSampling::ReservoirSampling</a></div><div class="ttdeci">ReservoirSampling(size_t size, std::vector&lt; Type &gt; &amp;samples, std::default_random_engine &amp;rng)</div><div class="ttdoc">initialize reservoir sampler </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00034">reservoir_sampling.hpp:34</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a35e83b77174bc9895cbc88cab7a7f706"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a35e83b77174bc9895cbc88cab7a7f706">thrill::common::ReservoirSamplingGrow::samples</a></div><div class="ttdeci">const std::vector&lt; Type &gt; &amp; samples() const </div><div class="ttdoc">access to samples </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00263">reservoir_sampling.hpp:263</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_a22a9772c09848d90444dda7fefa4d9ce"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a22a9772c09848d90444dda7fefa4d9ce">thrill::common::ReservoirSamplingFast::count</a></div><div class="ttdeci">size_t count() const </div><div class="ttdoc">number of items seen </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00128">reservoir_sampling.hpp:128</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_a36e9b114cd99244356721de926795597"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#a36e9b114cd99244356721de926795597">thrill::common::ReservoirSamplingFast::calc_next_gap</a></div><div class="ttdeci">size_t calc_next_gap()</div><div class="ttdoc">draw gap size from geometric distribution with p = size_ / count_ </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00146">reservoir_sampling.hpp:146</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a44d02ef658f5ec305b4e5c3994d28c63"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a44d02ef658f5ec305b4e5c3994d28c63">thrill::common::ReservoirSamplingGrow::calc_steps_to_next_resize</a></div><div class="ttdeci">size_t calc_steps_to_next_resize() const </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00317">reservoir_sampling.hpp:317</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_afa3210bc46cfad23b98aa3743b80024b"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#afa3210bc46cfad23b98aa3743b80024b">thrill::common::ReservoirSamplingGrow::rng_</a></div><div class="ttdeci">std::default_random_engine &amp; rng_</div><div class="ttdoc">source of randomness </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00293">reservoir_sampling.hpp:293</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a8acc71da85d7ab98b1507ba75526383f"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a8acc71da85d7ab98b1507ba75526383f">thrill::common::ReservoirSamplingGrow::steps_to_resize</a></div><div class="ttdeci">size_t steps_to_resize</div><div class="ttdoc">items to process prior to checking for reservoir resize </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00289">reservoir_sampling.hpp:289</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_ab8ca9afa9d9a2d502b0b8a0da644872e"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#ab8ca9afa9d9a2d502b0b8a0da644872e">thrill::common::ReservoirSamplingFast::gap_</a></div><div class="ttdeci">size_t gap_</div><div class="ttdoc">source of randomness </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00139">reservoir_sampling.hpp:139</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_aac782da1f912bceb5d8ad00c8dc892ac"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aac782da1f912bceb5d8ad00c8dc892ac">thrill::common::ReservoirSamplingFast::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdoc">size of reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00125">reservoir_sampling.hpp:125</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a36e9b114cd99244356721de926795597"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a36e9b114cd99244356721de926795597">thrill::common::ReservoirSamplingGrow::calc_next_gap</a></div><div class="ttdeci">size_t calc_next_gap()</div><div class="ttdoc">draw gap size from geometric distribution with p = size_ / count_ </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00301">reservoir_sampling.hpp:301</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a6b06728795e8f208c0755874665b3a51"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a6b06728795e8f208c0755874665b3a51">thrill::common::ReservoirSamplingGrow::count_</a></div><div class="ttdeci">size_t count_</div><div class="ttdoc">number of items seen </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00285">reservoir_sampling.hpp:285</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_aff52e2dd0033a4a098aa37da3cb3c957"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#aff52e2dd0033a4a098aa37da3cb3c957">thrill::common::ReservoirSamplingGrow::samples_</a></div><div class="ttdeci">std::vector&lt; Type &gt; &amp; samples_</div><div class="ttdoc">reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00291">reservoir_sampling.hpp:291</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_a6b06728795e8f208c0755874665b3a51"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#a6b06728795e8f208c0755874665b3a51">thrill::common::ReservoirSampling::count_</a></div><div class="ttdeci">size_t count_</div><div class="ttdoc">number of items seen </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00068">reservoir_sampling.hpp:68</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_ae4abc96f7ce71415a54f3f2c453e0a39"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#ae4abc96f7ce71415a54f3f2c453e0a39">thrill::common::ReservoirSampling::samples_</a></div><div class="ttdeci">std::vector&lt; Type &gt; samples_</div><div class="ttdoc">reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00070">reservoir_sampling.hpp:70</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingFast_html_aff52e2dd0033a4a098aa37da3cb3c957"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingFast.html#aff52e2dd0033a4a098aa37da3cb3c957">thrill::common::ReservoirSamplingFast::samples_</a></div><div class="ttdeci">std::vector&lt; Type &gt; &amp; samples_</div><div class="ttdoc">reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00141">reservoir_sampling.hpp:141</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_ab8ca9afa9d9a2d502b0b8a0da644872e"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#ab8ca9afa9d9a2d502b0b8a0da644872e">thrill::common::ReservoirSamplingGrow::gap_</a></div><div class="ttdeci">size_t gap_</div><div class="ttdoc">items to skip until next sample (used in gap algorithm) </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00287">reservoir_sampling.hpp:287</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSamplingGrow_html_a22a9772c09848d90444dda7fefa4d9ce"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSamplingGrow.html#a22a9772c09848d90444dda7fefa4d9ce">thrill::common::ReservoirSamplingGrow::count</a></div><div class="ttdeci">size_t count() const </div><div class="ttdoc">number of items seen </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00260">reservoir_sampling.hpp:260</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_a22a9772c09848d90444dda7fefa4d9ce"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#a22a9772c09848d90444dda7fefa4d9ce">thrill::common::ReservoirSampling::count</a></div><div class="ttdeci">size_t count() const </div><div class="ttdoc">number of items seen </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00059">reservoir_sampling.hpp:59</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_aac782da1f912bceb5d8ad00c8dc892ac"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#aac782da1f912bceb5d8ad00c8dc892ac">thrill::common::ReservoirSampling::size</a></div><div class="ttdeci">size_t size() const </div><div class="ttdoc">size of reservoir </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00056">reservoir_sampling.hpp:56</a></div></div>
<div class="ttc" id="namespacethrill_1_1common_html_ac55d70406741c4f4be46fbb8f4dfd832"><div class="ttname"><a href="namespacethrill_1_1common.html#ac55d70406741c4f4be46fbb8f4dfd832">thrill::common::max</a></div><div class="ttdeci">static constexpr const T &amp; max(const T &amp;a, const T &amp;b)</div><div class="ttdoc">template for constexpr max, because std::max is not good enough. </div><div class="ttdef"><b>Definition:</b> <a href="functional_8hpp_source.html#l00065">functional.hpp:65</a></div></div>
<div class="ttc" id="classthrill_1_1common_1_1ReservoirSampling_html_a35e83b77174bc9895cbc88cab7a7f706"><div class="ttname"><a href="classthrill_1_1common_1_1ReservoirSampling.html#a35e83b77174bc9895cbc88cab7a7f706">thrill::common::ReservoirSampling::samples</a></div><div class="ttdeci">const std::vector&lt; Type &gt; &amp; samples() const </div><div class="ttdoc">access to samples </div><div class="ttdef"><b>Definition:</b> <a href="reservoir__sampling_8hpp_source.html#l00062">reservoir_sampling.hpp:62</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5fdb396fad1e5f0fc72d07871826fecf.html">thrill</a></li><li class="navelem"><a class="el" href="dir_19de9a7cb0ad0c6b03f8c7369b4f5139.html">common</a></li><li class="navelem"><a class="el" href="reservoir__sampling_8hpp.html">reservoir_sampling.hpp</a></li>
    <li class="footer">Generated on Sat Oct 14 2017 08:17:14 for Thrill by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
